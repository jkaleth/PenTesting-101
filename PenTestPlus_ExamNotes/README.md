# PenTest + Exam Prep
## Lesson 1 - Scoping Organization/Customer Requirements

- To learn more about the vulnerabilities, you can often click on CVE names, which have hyperlinks to the record in the **National Vulnerability Database (NVD)**. Once there, you can read more details.

- As vulnerabilities are identified, they are first rated as to the severity using the Common **Vulnerability Scoring System (CVSS).** The score is derived using a set of metrics, which helps in prioritizing vulnerabilities.

- The information from the CVSS is fed into the **Common Vulnerabilities and Exposures (CVE).** The CVE is a listing of all publicly disclosed vulnerabilities.

- **The ISSAF** contains a list of 14 documents that relate to PenTesting, such as guidelines on business continuity and disaster recovery along with legal and regulatory compliance

**The Penetration Testing Execution Standard (PTES)** has seven main sections that provide a comprehensive overview of the proper structure of a complete PenTest. Some of the sections include details on topics such as pre-engagement interactions, threat modeling, vulnerability analysis, exploitation, and reporting.

The **Open Web Application Security Project (OWASP)** is an organization aimed at increasing awareness of web security and provides a framework for testing during each phase of the software development process.

**OSSTMM** provides a holistic structured approach to PenTesting. Written in 2000, the open-source document stresses auditing, validation, and verification.

Computerized electronic patient records are referred to as **electronic protected health information (e-PHI).** With HIPAA, the **e-PHI** of any patient must be protected from exposure, or the organization can face a hefty fine.

**The Health Insurance Portability and Accountability Act (HIPAA)** is a law that mandates rigorous requirements for anyone that deals with patient information.

**The California Consumer Privacy Act (CCPA)** was enacted in 2020 and outlines specific guidelines on how to appropriately handle consumer data.

In 2018 the EU enacted the **General Data Protection Regulation (GDPR)**, which outlines specific requirements on how consumer data is protected. 

*NIST* has many resources for cybersecurity professionals that include the Special Publication (SP) 800 series, which deals with cybersecurity policies, procedures, and guidelines.

### PCI Compliance

**The levels are as follows:**

    Level 1 - is a large merchant with over six million transactions a year.
    Level 2 - is a merchant with one to six million transactions a year.
    Level 3 - is a merchant with 20,000 to one million transactions a year.
    Level 4  -is a small merchant with under 20,000 transactions a year.

The activity required for each level to prove compliance with the guidelines, is as follows:

    **Level 1—** must have an external auditor perform the assessment by an approved Qualified Security Assessor (QSA).

    **Levels 1 and 2** must complete a RoC.

    **Levels 2– 4** —can either have an external auditor or submit a self-test that proves they are taking active steps to secure the infrastructure.

In addition to PCI DSS, there are several laws in the United States and the European Union (EU) that deal with the protection of consumer data.

 One such law is GDPR, which has a global reach.

### Dissecting GDPR

In 2018 the EU enacted the General Data Protection Regulation (GDPR), which outlines specific requirements on how consumer data is protected. The law affects anyone who does business with residents of the EU and Britain. This comprehensive law focuses on the privacy of consumer data and, more importantly, gives consumers the ability to control how their data is handled.

**Some of the components of this law include:**

    **REQUIRE CONSENT** - if a company wants to gather information on your searching and buying patterns, it must first obtain permission. A client must be allowed to accept or decline for each separate data source , i.e., email addresses for marketing or IP addresses for analytics.

    **RESCIND CONSENT** —just as the consumer can give consent for a company to use their information, they can opt out at any time. Known as the right to be forgotten rule, this puts control back in the hands of the consumer.

    **GLOBAL REACH** — the GDPR affects anyone who does business with residents of the EU and Britain. The statute relates to e-commerce, as websites do not have a physical boundary. If you do business with anyone in the EU and Britain, this rule will prevail.
    
    **RESTRICT DATA COLLECTION** —organizations should collect only the minimal amount of data that is needed to interact with the site.
    
    **VIOLATION REPORTING** — if the company’s consumer database is compromised, they must report the breach within 72 hours.

## Lesson 2 - Defining Rules of Engageent

<ins>STANDARDS

- **DRIVERS** - **The Driver's Privacy Protection Act (DPPA)**
governs the privacy and disclosure of personal information gathered by state Departments of Motor Vehicles.

- **FINANCE** - **The Gramm-Leach-Bliley Act (GLBA)** requires financial institutions to ensure the security and confidentiality of client information and take steps to keep customer information secure.

- **PEN TESTING** - **The Penetration Testing Execution Standard (PTES**) was developed by business professionals as a best practice guide to PenTesting. The PTES approaches the standard business aspect in that it doesn't have technical guidelines specifically addressed in the document.

- **PEN TESTING** - **Open-Source Security Testing Methodology Manual (OSSTMM)** provides a holistic structured approach to PenTesting. Written in 2000, the open-source document stresses auditing, validation, and verification.

- **MEDICAL/HEALTH** - **The Health Insurance Portability and Accountability Act (HIPAA)** Privacy Rule establishes national standards to protect the privacy of individuals' medical records.

- **PENT TESTING**- **The ISSAF** contains a list of 14 documents that relate to PenTesting, such as guidelines on business continuity and disaster recovery along with legal and regulatory compliance.

<ins>Engagement Agreements

- **ADDITIONAL CHARGES** - **The Master Service Agreement (MSA**) is a contract that establishes guidelines for any business documents executed between two parties. It can be used to cover recurring costs and any unforeseen additional charges.

- **EXPECTATIONS** - **The Statement of Work (SOW)** is a document that defines the expectations for a specific business arrangement. It typically includes a list of deliverables, responsibilities of both parties, and others.

- **DETAILS/TERMINATION** - **A service-level agreement (SLA)** is a contract that outlines the detailed terms under which a service is provided, including reasons the contract may be terminated.

## Lesson 3- Footprinting & Gathering Intelligence
**VOIP** - **Service (SRV)** record provides host and port information on services such as voice over IP (VoIP) and instant messaging (IM).

**Text (TXT)** record provides information about a resource such as a server or network in human readable form.

**Nameserver (NS)** record lists the authoritative DNS server for a particular domain. A standard DNS query will use DNS servers to identify the Internet Protocol (IP) address behind a particular domain or resource name.

**Mail Exchange (MX)** record provides the mail server that accepts email messages for a particular domain.

## Question
**Question-**
A security analyst is trying to find older versions of a company's website which contained sensitive information. They are worried that attackers might still be able to find older versions, so they want to try using web search commands. Which web search command would help them search?

Use a standard **cache** search on a site, and you will see a recent view of the website. To do a quick check simply type cache: in the address bar. For example, cache:https://comptia.org.

**inanchor** searches anchor text. For example, use inanchor:Certification report to search for any pages whose anchor text includes the text "Certification" and have the text "report" anywhere on the page.

One would use **inurl:Certification report** to search for any pages whose URLs include the text "Certification" and have the text "report" anywhere on the page.

The security professional would enter the **site:comptia.org** report to search CompTIA's website only for results including the text "report."

***Question-***

A security researcher wants to scan documents against a website for only pdf documents. What metagoofil parameter could they use?

- **PDF** - **metagoofil -t** pdf scans for pdf documents. Metagoofil scrapes the metadata, and then displays the information using Hypertext Markup Language (HTML).

**DOCUMENTS** - **metagoofil -d** comptia.org scans for documents on Comptia.org. Metagoofil uses various python libraries such as PdfMiner, GoogleSearch, and Hachoir.

**LIST** - **metagoofil -l 75** searches for 75 documents. The output can then be viewed in a standard browser. Another valuable tool is FOCA, which can discover metadata from a variety of sources.

**DOWNLAOD** - **metagoofil -n 25** downloads 25 files. You can download a copy of Metagoofil from GitHub. In addition, the tool is built into Kali Linux. 

***Question-***

**CERTS** - The **Certification Revocation List (CRL)** is a list of certificates that in some way have been deemed invalid. Although effective, most online services have moved to the newer OCSP to check the validity of the certificate.

**Network Connections (ncpa.cpl)** is a Control Panel applet for managing adapter devices, including IP address information.

A more useful field in a digital certificate from a reconnaissance perspective is the **subject alternative name (SAN). SANs** can identify specific subdomains that can be covered by the certificate.

**The Social Engineering Toolkit (SET)** is a Python-based collection of tools that can be used when conducting a social engineering PenTest.

The **robots.txt** file is the most common and effective way to prevent search engine crawlers from indexing or accessing specific pages or directories. A robots.txt file can be easily created and updated as needed, and it is a standard method that is recognized by most bots and crawlers.
 
An **ACL** could be effective in restricting access to specific directories, but it may not be as easy to implement as using a robots.txt file.
 
**Blocking specific user agents** could work to prevent specific bots or crawlers from accessing the site, but it may not be as flexible or scalable as using a robots.txt file.
 
**Creating a noindex meta tag**on each page to be excluded would not prevent other types of bots or crawlers from accessing specific pages.

### <ins> Tools

**theHarvester** is an intuitive tool that can search a company's visible threat landscape. The tool gathers information on subdomain names, employee names, email addresses, PGP key entries, and open ports and service banners.

**Shodan** is a search engine designed to locate and index IoT devices that are connected to the Internet.

**Dirbuster** is specifically geared towards website enumeration. There are numerous tools and techniques available to evaluate a website.

**Metagoofil** uses various python libraries such as PdfMiner, GoogleSearch, and Hachoir to scrape the metadata, and then displays the information using Hypertext Markup Language (HTML). 

## Lesson 4- Evaulating Human and Physical Vulnerabilities

**intitle:"DPH" "web login setting"** it would be used to find information of D -Link Phones. If they don't have the password, they can search online for the default password to try on the targeted system.

**CISCO** - **iinurl:"ccmuser/logon.asp"** it would be used to find Cisco CallManager instances. They can also try some other Google Hacking to find more information on VoIP phones that you can use to launch the attack.

**iintitle:"Grandstream Device Configuration"** i password would be used to find information about Grandstream phones.

**iinurl:"CallManager"** it would not be a valid instance of attempting to find CallManager instances, they would have to search for ccmuser.

## Lesson 5 - Preparing the Vulnerability Scan

**OPEN SOURCE - specific vulns** - **Nikto** is an open-source web server scanner that can complete comprehensive testing on web servers for a variety of vulnerabilities, such as anticlickjacking X-Frame-options header, and dangerous files and CGIs.

A team can run a vulnerability scan using the **Open Vulnerability Assessment Scanner. OpenVAS** will list the vulnerabilities along with a risk rating that summarizes the overall state of the site that was tested.

**SQLmap** is an open-source database scanner that searches for and exploits SQL injection flaws.

When testing for vulnerabilities, one tool the team can use is **Censys**, an attack surface analyzer, similar to Shodan, to identify exposed systems. 

**Hping3** is also a tool to craft and send a malformed packet to your target. For example, the Christmas (XMAS) scan might be able to bypass security mechanisms that follow strict interpretation of RFC 793.

### <ins> Active Reconnaissance
 <ins>**Grabbing Banners**

Banner Grabbing is a technique used during reconnaissance to gather information about network hosts and the services running on open ports. The process involves attempting to open a session with a service and getting the service to identify itself.

You can use **Wget**, **Netcat**, and other tools to grab banners from services and protocols such as FTP, SSH, HTTP, SMTP, POP3, DNS, Telnet, Microsoft netbios-ssn, and more. Acquiring these banners can help you focus your attacks on specific services.

**The following are some examples of banner grabbing:**

Wget can be used to grab a banner using the following syntax: 

```wget <target IP> -S.``` When using this command, -S will print the HTTP headers that are sent by the server.

Another option is netcat (nc), a popular tool for Unix and Linux.

<ins>**Running Scans**

Scanning Considerations:

- **Time to run scans** —Some vulnerability scans take a great deal of time to run, such as web app scans, which can take days. You may need to configure the run of the scan at a more superficial level. You can also set the scan to stop scanning after a certain amount of time or when you get a satisfactory number of results.

- **Bandwidth limitations** —Intensive scans can consume a significant amount of bandwidth, especially if several concurrent scans are running against multiple hosts. This can delay the scans or disrupt them entirely.

- **Fragile systems**—Some systems, such as a legacy server or nontraditional assets such as Internet of Things (IoT) devices, may not be able to withstand an intensive scan. In addition, in most cases the team should use caution when scanning printers, as the scan may cause a printer to print out random data and waste a great deal of paper.

- **Query throttling** —The number of queries launched by the scanner in order to overcome bandwidth limitations can be throttled. In addition, it can help avoid issues with fragile systems and other non-traditional assets that have weak or outdated hardware or are inherently unstable.

<ins>Packet crafting involves four stages:

- **Assemble** — create the packet to be sent.
- **Edit** — modify the contents of a created or captured packet.
- **Play** — send/resend -  a packet on the network.
- **Decode** - —capture and analyze traffic generated using a packet analyzer such as Wireshark.

You can craft your packet(s) using the command line, GUI, or script options.

<ins>Some Packet Crafters Include:

**Scapy** - is a tool to craft and send a malformed packet to your target. The type of packet crafted will be dependent on security products and rules.

**Hping3** -is also a tool to craft and send a malformed packet to your target. For example, the Christmas (XMAS) scan might be able to bypass security mechanisms that follow strict interpretation of RFC 793.

<ins>Avoiding Antivirus

Obfuscating a known signature uses a tool such as **ObfuscatedEmpire** in a solution. It is a fork of Empire that has Invoke-Obfuscation baked directly into its functionality.

## Lesson 6 - Scanning Logical Vulnerabilities

<ins> Active Reconnaissance



## Lesson 16

**How to Initiate Persistence**: 

- An **Advanced Persistent Threat (APT)** is a type of threat in which an unauthorized user gains access to a system or network and remains undetected for an extended period. During this time, they typically exfiltrate data or perform other malicious activities.
 
- A **backdoor** is a hidden mechanism that provides unauthorized access to a system. While it might be a component of an attack, it's not a description of a long-term, data-exfiltrating threat.

- **Reverse shells** provide remote access, and they require additional measures to become persistent. Embedding the shell in startup scripts, registry entries, or other autostart locations ensures the connection is re-established after the system reboots or disruptions, providing persistent access.
 
- A **bind shell** is a type of **reverse shell** where the target system "binds" its shell to a local network port for remote access. This doesn't necessarily imply a long-term, data-exfiltrating threat.
 
- A **daemon** refers to a background process or service on a system. It doesn't describe the situation which is associated with a long-term, data-exfiltrating threat.

**How to Gather Passwords**:

- The PenTester is using **mimikatz** which gathers credentials by extracting key elements from memory such as cleartext passwords, hashes, and PIN codes.

- **Hashcat** is a password and hash cracking tool that uses different attack methods (dictionary, mask, hybrid) to add complexity and variability.

- **Brutespray** interprets results from an Nmap scan to automatically start medusa against the identified open ports and can also use results from nmap with option -sV to identify and target services on non-standard ports.

- **CeWL** generates word lists based on automatically navigating a website and collecting words from text as well as author/creator metadata from files that the tool finds.

**Password Cracking**

- The PenTester is using a **rule attack** which can make use of word lists to create variants and combinations and can then try trimming or expanding words or substituting numbers or special characters for letters.

- **Password spraying** is the concept of controlled brute-forcing by testing several accounts with common or targeted passwords.

- In a **mask attack** the cracking tool can try specific combinations of characters using placeholders (i.e., ?a?a?d?d?d?d).

- A **dictionary** attack is the most straightforward type of automated password attack. A password cracking tool goes through a list of words until it either finds the password or exhausts the list.
